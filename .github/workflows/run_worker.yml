# This is a GitHub Actions workflow file
# It will automatically run our Python worker script

name: Medium Agent Worker

# Controls when the action runs
on:
  # 1. Runs on a schedule: every 15 minutes
  schedule:
    - cron: '*/15 * * * *'

  # 2. Allows you to manually run this workflow from the Actions tab
  workflow_dispatch:

jobs:
  build:
    # The type of machine to run the job on (free)
    runs-on: ubuntu-latest

    steps:
      # 1. Checks out your repository's code
      - uses: actions/checkout@v4

      # 2. Sets up the Python language
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # A modern, stable Python version

      # 3. Installs the libraries from our requirements file
      - name: Install dependencies
        run: |
          pip install -r worker_requirements.txt

      # 4. Runs our worker script
      - name: Run worker script
        env:
          # This is how we pass the secrets to the Python script
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
        run: |
          python worker.py
